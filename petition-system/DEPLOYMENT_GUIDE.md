# Deployment Guide - Render Platform

This guide walks you through deploying the Tenkasi District Petition Redressal System on Render.

## üìã Prerequisites

- GitHub repository with your code
- Render account (free tier available)
- Basic understanding of environment variables

## üöÄ Deployment Steps

### Step 1: Prepare Your Repository

1. **Push Code to GitHub**
   ```bash
   git add .
   git commit -m "Initial commit - Petition System"
   git push origin main
   ```

2. **Verify Project Structure**
   Ensure your repository has this structure:
   ```
   petition-system/
   ‚îú‚îÄ‚îÄ backend/
   ‚îú‚îÄ‚îÄ frontend/
   ‚îú‚îÄ‚îÄ database/
   ‚îú‚îÄ‚îÄ render.yaml
   ‚îî‚îÄ‚îÄ README.md
   ```

### Step 2: Connect Repository to Render

1. **Login to Render**
   - Go to [render.com](https://render.com)
   - Sign in with GitHub

2. **Connect Repository**
   - Click "New +"
   - Select "Blueprint"
   - Connect your GitHub repository
   - Render will detect the `render.yaml` file

### Step 3: Configure Services

Render will automatically create services based on `render.yaml`, but you may need to verify:

#### Database Service
- **Name**: `petition-db`
- **Type**: PostgreSQL
- **Plan**: Starter (Free)
- **Database Name**: `petition_system`
- **User**: `petition_user`

#### Backend API Service
- **Name**: `tenkasi-petition-api`
- **Type**: Web Service
- **Environment**: Node
- **Plan**: Starter (Free)
- **Build Command**: `cd backend && npm install`
- **Start Command**: `cd backend && npm start`

#### Frontend Service
- **Name**: `tenkasi-petition-frontend`
- **Type**: Static Site
- **Build Command**: `cd frontend && npm install && npm run build`
- **Publish Directory**: `frontend/build`

### Step 4: Set Environment Variables

#### Backend Service Variables
```
NODE_ENV=production
PORT=5000
DATABASE_URL=[Auto-filled from database]
JWT_SECRET=[Auto-generated by Render]
JWT_EXPIRES_IN=7d
OFFICIAL_LOGIN_CODE=tgbvfrertyu4820
ADMIN_LOGIN_CODE=nbcfeodkms934
FRONTEND_URL=https://tenkasi-petition-frontend.onrender.com
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

#### Frontend Service Variables
```
REACT_APP_API_URL=https://tenkasi-petition-api.onrender.com/api
```

### Step 5: Deploy and Test

1. **Deploy Services**
   - Render will automatically start deploying
   - Monitor the build logs for any errors
   - Backend deployment usually takes 2-3 minutes
   - Frontend deployment usually takes 3-5 minutes

2. **Run Database Migrations**
   After backend deployment:
   - Go to backend service shell in Render dashboard
   - Run: `npm run migrate`
   - Or use the database migration endpoint via API

3. **Test the Application**
   - Visit your frontend URL
   - Test petition submission
   - Test petition tracking
   - Test official/admin login

## üîß Manual Configuration (Alternative)

If automatic deployment doesn't work, follow these manual steps:

### Create Database
1. **New PostgreSQL Database**
   - Name: `petition-db`
   - Plan: Starter
   - Note the connection string

### Create Backend Service
1. **New Web Service**
   - Connect GitHub repository
   - Name: `tenkasi-petition-api`
   - Environment: Node
   - Build Command: `cd backend && npm install`
   - Start Command: `cd backend && npm start`

2. **Add Environment Variables**
   ```
   NODE_ENV=production
   DATABASE_URL=<your-postgres-url>
   JWT_SECRET=<generate-secure-secret>
   OFFICIAL_LOGIN_CODE=tgbvfrertyu4820
   ADMIN_LOGIN_CODE=nbcfeodkms934
   FRONTEND_URL=<your-frontend-url>
   ```

### Create Frontend Service
1. **New Static Site**
   - Connect same GitHub repository
   - Name: `tenkasi-petition-frontend`
   - Build Command: `cd frontend && npm install && npm run build`
   - Publish Directory: `frontend/build`

2. **Add Environment Variables**
   ```
   REACT_APP_API_URL=<your-backend-url>/api
   ```

## üîç Troubleshooting

### Common Issues

1. **Build Failures**
   ```bash
   # Check package.json paths
   # Ensure all dependencies are listed
   # Verify Node.js version compatibility
   ```

2. **Database Connection Issues**
   ```bash
   # Verify DATABASE_URL format
   # Check database service is running
   # Run migrations after backend deployment
   ```

3. **CORS Errors**
   ```bash
   # Verify FRONTEND_URL in backend env vars
   # Check REACT_APP_API_URL in frontend
   # Ensure URLs match deployed services
   ```

4. **Environment Variable Issues**
   ```bash
   # Check all required variables are set
   # Verify JWT_SECRET is generated
   # Confirm login codes are correct
   ```

### Debugging Steps

1. **Check Build Logs**
   - Go to service dashboard
   - Click on "Logs" tab
   - Look for error messages

2. **Test API Endpoints**
   ```bash
   # Health check
   curl https://your-api-url.onrender.com/health
   
   # Test petition submission
   curl -X POST https://your-api-url.onrender.com/api/petitions \
     -H "Content-Type: application/json" \
     -d '{"from_name":"Test","to_department":"Revenue Department","whatsapp_number":"9876543210","petition_text":"Test petition"}'
   ```

3. **Database Connection Test**
   - Use Render shell to connect to backend
   - Run: `node -e "console.log(process.env.DATABASE_URL)"`
   - Test database connection

## üìä Performance Optimization

### Backend Optimization
- Enable compression middleware
- Implement caching for frequent queries
- Optimize database queries
- Use connection pooling

### Frontend Optimization
- Enable build optimization
- Implement code splitting
- Optimize images and assets
- Use CDN for static assets

### Database Optimization
- Add proper indexes
- Optimize query performance
- Regular maintenance tasks
- Monitor connection limits

## üîê Security Considerations

### Production Security
1. **Environment Variables**
   - Never commit secrets to repository
   - Use Render's secret generation
   - Rotate secrets regularly

2. **Database Security**
   - Use strong passwords
   - Enable SSL connections
   - Regular security updates

3. **API Security**
   - Implement rate limiting
   - Use HTTPS everywhere
   - Validate all inputs

### Monitoring
- Set up error tracking
- Monitor API performance
- Database performance monitoring
- Set up alerts for downtime

## üìà Scaling Considerations

### Free Tier Limitations
- Backend: 512MB RAM, sleeps after 15min inactivity
- Database: 1GB storage, 100 connections
- Static site: 100GB bandwidth/month

### Upgrade Path
- **Starter Plan**: $7/month, no sleep, more resources
- **Standard Plan**: $25/month, better performance
- **Pro Plan**: $85/month, high availability

## üîÑ Maintenance

### Regular Tasks
1. **Database Maintenance**
   - Monitor storage usage
   - Clean up old resolved petitions
   - Backup important data

2. **Security Updates**
   - Update dependencies regularly
   - Monitor security advisories
   - Test updates in staging

3. **Performance Monitoring**
   - Monitor response times
   - Check error rates
   - Review usage patterns

## üìû Support

### Render Support
- [Render Documentation](https://render.com/docs)
- [Render Community](https://community.render.com)
- Support tickets for paid plans

### Application Support
- Check application logs
- Review troubleshooting section
- Contact development team

---

**Deployment Complete!** Your Tenkasi District Petition Redressal System should now be live and accessible to citizens.